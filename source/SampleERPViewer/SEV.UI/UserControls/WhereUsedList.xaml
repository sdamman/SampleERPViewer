<UserControl x:Class="SEV.UI.UserControls.WhereUsedList"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:theme="clr-namespace:CustomT.UI"
             xmlns:conv="clr-namespace:SEV.UI.Converters"
             xmlns:uc="clr-namespace:SEV.UI.UserControls"
             mc:Ignorable="d" d:Background="White"
             d:DesignHeight="300" d:DesignWidth="800">

  <UserControl.Resources>
    <BooleanToVisibilityConverter x:Key="b2VC"/>
    <conv:ListToVisibilityConverter x:Key="l2VC"/>
    <conv:NullToCollapsedConverter x:Key="N2CC"/>
  </UserControl.Resources>

  <Grid Margin="20,0"
        Visibility="{Binding IsWhereUsedVisible, Converter={StaticResource b2VC}}">
    <Grid.RowDefinitions>
      <RowDefinition Height="2*"/>
      <RowDefinition Height="1*"/>
    </Grid.RowDefinitions>
    
    <GridSplitter Grid.Row="0" VerticalAlignment="Bottom" HorizontalAlignment="Stretch"
                  Height="6" Background="{theme:ThemeResource ResourceKey=MainThemeBlue}"/>
    
    <Grid x:Name="bomStdGrid" Grid.Row="0" Visibility="{Binding WhereUsedList,
                        Converter={StaticResource l2VC}}"
          Margin="0,0,0,10">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <Border Background="{theme:ThemeResource ResourceKey=MouseOverBackground}"
                Margin="-5,0,-5,0"/>
      <StackPanel x:Name="bomStdHeading" Grid.Row="0" Orientation="Horizontal">
        <TextBlock Text="Where Used Standard BOM" 
               FontFamily="Segoe UI Semibold" 
               FontSize="24"
               Foreground="{StaticResource brushMainThemeBlue}"/>
        <Button Style="{DynamicResource ButtonCopy}" 
              Height="25" Margin="4,0,4,-5"
              Foreground="{theme:ThemeResource ResourceKey=Complement}"
              d:Foreground="{StaticResource brushMainThemeBlue}"
              Command="{Binding CommandCopyWhereUsed}"/>
      </StackPanel>
      <uc:CurrentDate Grid.Row="0"  HorizontalAlignment="Right" VerticalAlignment="Bottom"/>

      <Border Grid.Row="1" BorderBrush="{theme:ThemeResource ResourceKey=MaxContrast}"
            d:BorderBrush="Black" BorderThickness="0,0,0,1">
        <Grid Margin="0,0,18,0">
          <Grid.Resources>
            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource bodyCopy}">
              <Setter Property="Foreground" Value="{theme:ThemeResource ResourceKey=Complement}"/>
            </Style>
          </Grid.Resources>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="7*"/>
            <ColumnDefinition Width="2*"/>
          </Grid.ColumnDefinitions>
          <CheckBox Grid.Column="0" Content="Parent" 
                  IsChecked="{Binding IsParentAscending}"
                  Style="{DynamicResource SortableHeaderCheck}"/>
          <TextBlock Grid.Column="1" Text="Parent Rev"/>
          <CheckBox Grid.Column="2" Content="Parent Description"
                  IsChecked="{Binding IsParentDescriptionAscending}"
                  Style="{DynamicResource SortableHeaderCheck}"/>
          <TextBlock Grid.Column="3" Text="Quantity Per"/>
        </Grid>
      </Border>
      <ScrollViewer x:Name="bomStd" Grid.Row="2"
                    MaxHeight="{Binding ActualHeight, ElementName=bomStdGrid, Mode=OneWay}">
        <ItemsControl ItemsSource="{Binding WhereUsedList, FallbackValue='1'}"
                    AlternationCount="2">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <DataTemplate.Resources>
                <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource bodyCopy}"/>
              </DataTemplate.Resources>

              <Grid x:Name="content">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="2*"/>
                  <ColumnDefinition Width="2*"/>
                  <ColumnDefinition Width="7*"/>
                  <ColumnDefinition Width="2*"/>
                </Grid.ColumnDefinitions>
                <Expander Grid.Column="0"
                          Style="{StaticResource ExpanderButton}"
                          Header="{Binding ParentPart, FallbackValue='551357'}"
                          Margin="15,1">
                    <uc:PartNumberBox Tag="{Binding ParentPart}"/>
                </Expander>
                <TextBlock Grid.Column="1" Text="{Binding ParentRev, FallbackValue='000'}"/>
                <TextBlock Grid.Column="2" Text="{Binding ParentDescription, 
                                              FallbackValue='DESCRIPTION\,LONG\,CHARACTERS'}"/>
                <TextBlock Grid.Column="3" Text="{Binding QuantityPer, FallbackValue='0.00'}"/>
              </Grid>
              <DataTemplate.Triggers>
                <Trigger Property="ItemsControl.AlternationIndex"
										 Value="1">
                  <Setter TargetName="content" 
											Property="Background"
											Value="{theme:ThemeResource ResourceKey=MinContrast}"/>
                </Trigger>
              </DataTemplate.Triggers>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>

    <Grid x:Name="bomJobGrid" Grid.Row="1" Visibility="{Binding WhereUsedJobListDisplay,
                        Converter={StaticResource l2VC}}">
      <Grid.RowDefinitions>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="Auto"/>
        <RowDefinition Height="*"/>
      </Grid.RowDefinitions>
      <Border Background="{theme:ThemeResource ResourceKey=MouseOverBackground}"
                Margin="0,0,0,2"/>
      <StackPanel x:Name="bomJobHeading" Grid.Row="0" Orientation="Horizontal">
        <TextBlock Text="Where Used Job Order BOM" Margin="5,2,0,0"
               FontFamily="Segoe UI Semibold" 
               FontSize="24"
               Foreground="{StaticResource brushMainThemeBlue}"/>
        <Button Style="{DynamicResource ButtonCopy}" 
              Height="25" Margin="4,0,4,-5"
              Foreground="{theme:ThemeResource ResourceKey=Complement}"
              d:Foreground="{StaticResource brushMainThemeBlue}"
              Command="{Binding CommandCopyWhereUsedJob}"/>
        <CheckBox Content="Hide CLOSED orders" 
                  IsChecked="{Binding AreClosedOrdersHidden}"
                  Style="{DynamicResource CheckBoxSmall}"
                  VerticalContentAlignment="Center"
                  Margin="50,4,0,0"/>
      </StackPanel>
      <Border Grid.Row="1" BorderBrush="{theme:ThemeResource ResourceKey=MaxContrast}"
            d:BorderBrush="Black" BorderThickness="0,0,0,1">
        <Grid Margin="0,0,18,0">
          <Grid.Resources>
            <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource bodyCopy}">
              <Setter Property="Foreground" Value="{theme:ThemeResource ResourceKey=Complement}"/>
            </Style>
          </Grid.Resources>
          <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*"/>
            <ColumnDefinition Width="1.5*"/>
            <ColumnDefinition Width="0.9*"/>
            <ColumnDefinition Width="1.5*"/>
            <ColumnDefinition Width="1.5*"/>
            <ColumnDefinition Width="1*"/>
            <ColumnDefinition Width="1*"/>
          </Grid.ColumnDefinitions>
          <CheckBox Grid.Column="0" Content="Job Number" 
                  IsChecked="{Binding IsJobNumberAscending}"
                  Style="{DynamicResource SortableHeaderCheck}"/>
          <CheckBox Grid.Column="1" Content="Parent Part" 
                  IsChecked="{Binding IsJobParentAscending}"
                  Style="{DynamicResource SortableHeaderCheck}"/>
          <TextBlock Grid.Column="2" Text="Parent Rev"/>
          <CheckBox Grid.Column="3" Content="Sales Order"
                  IsChecked="{Binding IsSalesOrderAscending}"
                  Style="{DynamicResource SortableHeaderCheck}"/>
          <CheckBox Grid.Column="4" Content="Job Status"
                  IsChecked="{Binding IsJobStatusAscending}"
                  Style="{DynamicResource SortableHeaderCheck}"/>
          <TextBlock Grid.Column="5" Text="Qty Needed"/>
          <TextBlock Grid.Column="6" Text="Qty Issued"/>
        </Grid>
      </Border>
      <ScrollViewer x:Name="bomJob" Grid.Row="2"
                    MaxHeight="{Binding ActualHeight, ElementName=bomJobGrid, Mode=OneWay}">
        <ItemsControl ItemsSource="{Binding WhereUsedJobListDisplay, FallbackValue='1'}"
                    AlternationCount="2">
          <ItemsControl.ItemTemplate>
            <DataTemplate>
              <DataTemplate.Resources>
                <Style TargetType="{x:Type TextBlock}" BasedOn="{StaticResource bodyCopy}"/>
              </DataTemplate.Resources>

              <Grid x:Name="content">
                <Grid.ColumnDefinitions>
                  <ColumnDefinition Width="2*"/>
                  <ColumnDefinition Width="1.5*"/>
                  <ColumnDefinition Width="0.9*"/>
                  <ColumnDefinition Width="1.5*"/>
                  <ColumnDefinition Width="1.5*"/>
                  <ColumnDefinition Width="1*"/>
                  <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>
                <Button Grid.Column="0" 
                        Content="{Binding JobNumber, FallbackValue='H2762-0001'}"
                        Command="{Binding DataContext.CommandCallJobNumber, 
                  RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=Window}}"
                        CommandParameter="{Binding JobNumber}"
                        HorizontalContentAlignment="Left"
                        HorizontalAlignment="Left"
                        MaxWidth="100" Padding="10,0"
                        Margin="3,1" Cursor="Hand"/>
                <Expander Grid.Column="1"
                          Style="{StaticResource ExpanderButton}"
                          Header="{Binding ParentPart, FallbackValue='51350'}"
                          Margin="25,1">
                  <uc:PartNumberBox Tag="{Binding ParentPart}"/>
                </Expander>
                <TextBlock Grid.Column="2" Text="{Binding ParentRev, FallbackValue='000'}"/>
                <Button Grid.Column="3" 
                        Content="{Binding SalesOrder, FallbackValue='078713'}"
                        Command="{Binding DataContext.CommandCallSalesOrder, 
                  RelativeSource={RelativeSource Mode=FindAncestor,AncestorType=Window}}"
                        CommandParameter="{Binding SalesOrder}"
                        HorizontalContentAlignment="Left"
                        HorizontalAlignment="Left"
                        MaxWidth="100" Padding="10,0"
                        Margin="3,1" Cursor="Hand"
                        Visibility="{Binding SalesOrder, Converter={StaticResource N2CC}}"/>
                <TextBlock Grid.Column="4" Text="{Binding JobStatus, FallbackValue='OPEN'}"/>
                <TextBlock Grid.Column="5" Text="{Binding QuantityNeeded, FallbackValue='0.00'}"/>
                <TextBlock Grid.Column="6" Text="{Binding QuantityIssued, FallbackValue='0.00'}"/>
              </Grid>
              <DataTemplate.Triggers>
                <Trigger Property="ItemsControl.AlternationIndex"
										 Value="1">
                  <Setter TargetName="content" 
											Property="Background"
											Value="{theme:ThemeResource ResourceKey=MinContrast}"/>
                </Trigger>
              </DataTemplate.Triggers>
            </DataTemplate>
          </ItemsControl.ItemTemplate>
        </ItemsControl>
      </ScrollViewer>
    </Grid>
  </Grid>
</UserControl>
